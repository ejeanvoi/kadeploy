#!/bin/bash


if [ -x /etc/kadeploy3/load_kadeploy_env ] && [ -z "${KADEPLOY_CONFIG_DIR}" ]
then
    KADEPLOY_CONFIG_DIR=/etc/kadeploy3
    export KADEPLOY_CONFIG_DIR
elif [ ! -x $KADEPLOY_CONFIG_DIR/load_kadeploy_env ]
then
    echo "The Kadeploy environment cannot be loaded, please check your configuration"
    exit 1
fi

source $KADEPLOY_CONFIG_DIR/load_kadeploy_env

# Load the normal or async client
if [[ " $@" == *" --async "* ]] || [[ "$@" == *" --async" ]]
then
  ruby $KADEPLOY_INSTALL_DIR/src/kapower_async.rb "${@//--async}"
else
  ruby $KADEPLOY_INSTALL_DIR/src/kapower.rb "$@"
fi
